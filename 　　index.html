<!DOCTYPE html>
<html>
    <head>
        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <title>LINE Viewer</title>
    </head>
    <body>
        <div id="container" style="width:500px;margin:50px;padding: 50px 50px 100px 50px; border: 1px solid #666;border-radius: 5px;">
          
          <div class="mb-3">
            <label for="lineName" class="form-label">ğŸ““ãƒ¦ãƒ¼ã‚¶ãƒ¼å</label>
            <input type="text" class="form-control" id="lineName">
            <p class="text-black-50 small">â€»è‡ªåˆ†å´ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„(ä¾‹ï¼šãŸã‚ã†)ï¼ˆè‡ªåˆ†ãŒæŠ•ç¨¿ã—ãŸğŸ’¬ã«ãªã‚Šã¾ã™ï¼‰</p>
          </div>

          <div class="mb-3">
            <label for="lineHistoryText" class="form-label">ğŸ““è²¼ã‚Šä»˜ã‘ãƒ†ã‚­ã‚¹ãƒˆ</label>
            <textarea class="form-control" id="lineHistoryText" rows="10" cols="10"></textarea>
            <p class="text-black-50 small">â€»ãƒ¦ãƒ¼ã‚¶ãƒ¼åã«åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ãƒ»å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆæ­£å¸¸ã«å‹•ä½œã—ã¾ã›ã‚“</p>
          </div>
          <div class="float-end">
            <button id="createLineImage" class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#exampleModal">ä½œæˆã™ã‚‹</button>
            <!-- <button id="createLineImageForAnimation">ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§å®Ÿè¡Œ</button>
            <button id="createLineImageForClick">ã‚¯ãƒªãƒƒã‚¯ã§ä¸€ã¤ãšã¤</button> -->
          </div>

          <!-- Modal start-->
          <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <!-- ã“ã“ã‹ã‚‰LINEã®ãƒ‡ã‚¶ã‚¤ãƒ³ -->
                  <div id="lineView"class="line__container" style="border:1px solid black;width:500px;height:1100px">
                    <div class="line__title">
                      ãƒãƒ£ãƒƒãƒˆå
                    </div>
                    <div class="line__contents scroll" id="lineContents">
                    </div>
                  </div>
                  <!-- ã“ã“ã¾ã§LINEã®ãƒ‡ã‚¶ã‚¤ãƒ³ -->
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">é–‰ã˜ã‚‹</button>
                  <button type="button" class="btn btn-primary">HTMLã‚’ä¿å­˜ã™ã‚‹</button>
                </div>
              </div>
            </div>
          </div>
          <!-- Modal end-->

        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
        <script>

            document.getElementById('createLineImage').addEventListener('click', () => {

                // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ¼ãƒ ã‚’è‡ªåˆ†ã¨ã™ã‚‹
                const name = document.getElementById('lineName').value
                const line = new LINE(name);

                line.reset()

                const text = getInputLineHistory()
                const textArr = line.formatLineMsgArr(text)

                // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒˆãƒ¼ã‚¯å†…å®¹ã‚’è¨­å®š
                textArr.forEach(text => {
                  line.createMessage(text)
                })
            })
            // document.getElementById('createLineImageForAnimation').addEventListener('click', async () => {

            //     // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ¼ãƒ ã‚’è‡ªåˆ†ã¨ã™ã‚‹
            //     const name = document.getElementById('lineName').value
            //     const line = new LINE(name);

            //     const text = getInputLineHistory()
            //     const textArr = line.formatLineMsgArr(text)

            //     // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒˆãƒ¼ã‚¯å†…å®¹ã‚’è¨­å®š
            //     for(let i =0; i <textArr.length; i++) {
            //       line.createMessage(textArr[i])
            //       await sleep()
            //     }
            // })

            // let clickCount = 0;
            // document.getElementById('createLineImageForClick').addEventListener('click', () => {

            //     // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ¼ãƒ ã‚’è‡ªåˆ†ã¨ã™ã‚‹
            //     const name = document.getElementById('lineName').value
            //     const line = new LINE(name);

            //     const text = getInputLineHistory()
            //     const textArr = line.formatLineMsgArr(text)

            //     if(clickCount + 1 > textArr.length) {
            //       console.log('end')
            //       return
            //     }
            //     console.log(clickCount)
            //     console.log(textArr.length)

            //     // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒˆãƒ¼ã‚¯å†…å®¹ã‚’è¨­å®š
            //     line.createMessage(textArr[clickCount])
            //     clickCount++
            // })

            // function sleep()
            // {
            //   console.log('A')
            //   return new Promise(r => setTimeout(r, 2000))
            // }



            function getInputLineHistory() {
                const textarea = document.getElementById('lineHistoryText')
                const lineHistoryData = textarea.value
                return lineHistoryData
            }


            

            //ã‚¯ãƒ©ã‚¹ã®å®šç¾©
            class LINE {

              // ãƒ€ãƒ–ãƒ«ã‚¯ã‚ªãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å†…ã®æ”¹è¡Œã‚’å¤‰æ›
              NEWLINE = "<br>"
              // ã‚¹ãƒšãƒ¼ã‚¹ã‚’åŒºåˆ‡ã‚‹ã¨ãã®ãƒ‡ãƒªãƒŸã‚¿
              DELIMITER = '[Â¥]'

              /**
               * yourNameã®æ–‡å­—åˆ—ãŒè‡ªèº«ã®å¹ãå‡ºã—ã«ãªã‚‹ 
               * 
               */
              constructor(yourName) {
                // type ã¯Partnerã‹Ypu
                this._yourName = yourName
                this._generator = new HtmlGenerator();
              }

              /**
               * ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚‚ã¨ã«ç”»é¢ã«è¡¨ç¤ºã™ã‚‹
               * 
               */
              createMessage(text) {
                  // è¤‡æ•°ã®å…¨è§’ã¾ãŸã¯åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã‚’ãƒ‡ãƒªãƒŸã‚¿ã«ã™ã‚‹
                  const formatText = text.replace(/[	| ]+/g, this.DELIMITER)
                  //ã€€åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã‚’åˆ†å‰²
                  const textArr = formatText.split(this.DELIMITER);

                  // æ—¥ä»˜ãƒ»åå‰ãƒ»ãƒ†ã‚­ã‚¹ãƒˆã®ï¼“ã¤ä»¥ä¸‹ã®å ´åˆã¯å‡¦ç†ã‚’çµ‚ãˆã‚‹
                  /// ä¾‹ï¼šæ—¥ä»˜ãƒ»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å–ã‚Šæ¶ˆã—ãªã©
                  if(textArr.length < 3) {
                      console.log(textArr)
                      console.log(formatText)
                      console.log('no msg')
                      return
                  }
                  //ä»¥ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ã¯ãªã„å ´åˆã¯å‡¦ç†ã‚’è¡Œã‚ãªã„
                  // 00:00 Name TEXTTEXT
                  const time = textArr[0]
                  const name = textArr[1]

                  // å†’é ­ï¼’ã¤ã¯å‰Šé™¤
                  textArr.shift()
                  textArr.shift()
                  console.log(textArr)




                  const message = textArr.join(' ')
                  console.log(message)

                  // const time = textArr[0]
                  // const name = textArr[1]
                  // const message = textArr[2]

                  if (name == this._yourName) {
                    this._generator.createComment(time, name, message)
                  } else {
                    this._generator.createPartnerComment(time, name, message)
                  }
              }

              /**
               * ã‚³ãƒ³ãƒ†ãƒŠã®ä¸­èº«ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹
               * 
               */
              reset() {
                this._generator.reset()
              }

              /**
               * textareaã®ãƒ‡ãƒ¼ã‚¿ã‚’é…åˆ—ç”¨ã«åŠ å·¥ã™ã‚‹
               * 
               */
              formatLineMsgArr(text) {
                const formatText = this._formatLineHistory(text);
                const lineSplitText = this._splitNewLine(formatText)
                return lineSplitText

              }

              /**
               * LINEå±¥æ­´ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã™ã‚‹
               * 
               */
              _formatLineHistory(text) {
                  const ret = text.replace(/"([^"]*)"/g, (match, p1) => {
                      return p1.replace(/(\n)/g, this.NEWLINE);
                  })
                  return ret;
              }

              /**
               * æ”¹è¡Œã§åˆ†å‰²ã™ã‚‹
               * 
               */
              _splitNewLine(text) {
                  return text.split("\n")
              }


            }

            class HtmlGenerator {

              constructor () {
                this._container = document.getElementById('lineContents')
              }


              /**
               * ã‚³ãƒ³ãƒ†ãƒŠã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹
               * 
               */
              reset() {
                this._container.innerHTML = ''
              }


              /**
               * ç›¸æ‰‹å´ã®å¹ãå‡ºã—ã‚’ä½œæˆã™ã‚‹
               * 
               */
              createPartnerComment(time, name, message) {
                  const div = document.createElement('div');
                  div.classList.add('line__left');

                  const icon = document.createElement('figure')
                  // icon.innerHTML = '<img src="https://api.multiavatar.com/preety.png" />'
                  icon.innerHTML = '<img src="https://iconbu.com/wp-content/uploads/2022/09/%E3%83%8F%E3%83%A0%E3%82%B9%E3%82%BF%E3%83%BC%E3%81%95%E3%82%93.jpg" />'

                  //partner
                  const divMessage = document.createElement('div');
                  divMessage.classList.add('line__left-text');
                  const divName = document.createElement('div');
                  divName.classList.add('name');
                  divName.innerHTML = '<br>' +name
                  const divText = document.createElement('div');
                  divText.classList.add('text');
                  divText.innerHTML = message

                  divMessage.appendChild(divName)
                  divMessage.appendChild(divText)
                  div.appendChild(icon)
                  div.appendChild(divMessage)


                  this._container.appendChild(div)
              }

              /**
               * è‡ªåˆ†å´ã®å¹ãå‡ºã—ã‚’ä½œæˆã™ã‚‹
               * 
               */
              createComment(time, name, message) {
                  const div = document.createElement('div');
                  div.classList.add('line__right');


                  const divDate = document.createElement('span');
                  divDate.classList.add('date');
                  divDate.innerHTML = 'æ—¢èª­<br>'+time

                  const divText = document.createElement('div');
                  divText.classList.add('text');
                  divText.innerHTML = message

                  div.appendChild(divText)
                  div.appendChild(divDate)


                  this._container.appendChild(div)
              }

            }



        </script>
        <style>
          body {
            display: flex;
            justify-content: center;
            align-items: center;
            
          }
          /*/////////////////////////////////////////////////
          //LINEé¢¨ãƒãƒ£ãƒƒãƒˆç”»é¢(ä¼šè©±æ–¹å¼)ã‚’è¨˜äº‹ã«è¡¨ç¤ºã™ã‚‹æ–¹æ³•
          /////////////////////////////////////////////////*/

          .line__container {
            padding:0;
            background: #7494c0;    /* LINEãƒˆãƒ¼ã‚¯ãƒ«ãƒ¼ãƒ èƒŒæ™¯è‰² */
            overflow: hidden;
            max-width: 400px;
            margin: 20px auto;
            font-size: 80%;
          }

          /* 1 ã‚¿ã‚¤ãƒˆãƒ«éƒ¨åˆ† */
          .line__container .line__title {
            background: #273246;
            padding: 10px;
            text-align: center;
            font-size: 150%;
            color: #ffffff;
          }

          /* 2 ä¼šè©±éƒ¨åˆ† */
          .line__container .line__contents {
            padding: 10px;
            overflow: hidden;
            line-height: 135%;
          }

          .line__container .scroll {
            height: 1000px;
            overflow-y: scroll;
          }

          /* 4 ã‚¹ã‚¿ãƒ³ãƒ—ç”»åƒæœ€å¤§å¹… */
          .line__container .stamp img {
            max-width:120px;
          }

          /* 5 ç›¸æ‰‹ã®ä¼šè©± */
          .line__container .line__left {
              /*width: 100%;*/ display: inline-block;
              position: relative;
              display: block;
              margin-bottom: 5px;
              max-width: 90%;
              clear: both;
          }

          /* 6 ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒ */
          .line__container .line__left figure {
              width: 50px;
              position: absolute;
              top: 15px;
              left: 0;
              padding: 0;
              margin: 0;

          }

          /* 7 æ­£æ–¹å½¢ã‚’ç”¨æ„ */
          .line__container .line__left figure img{
              border-radius: 50%;
              width: 50px;
              height: 50px;
          }

          .line__container .line__left .line__left-text {
            margin-left: 60px;      /* 70px */
          }

          .line__container .line__left .line__left-text .name {
            font-size: 80%;
            color: #ffffff;
          }

          /* 10 ã‚³ãƒ¡ãƒ³ãƒˆã‚¨ãƒªã‚¢ */
          .line__container .line__left .text {
            margin: 0; display: inline-block;
            position: relative;
            padding: 10px;
            border-radius: 20px;
            background-color: #EDF1EE;  /* å¹ãå‡ºã—èƒŒæ™¯è‰² ç›¸æ‰‹ */
            color: #000000;   /* ãƒˆãƒ¼ã‚¯æ–‡å­—è‰² ç›¸æ‰‹ */
            font-size: 11px;  /* ãƒˆãƒ¼ã‚¯æ–‡å­—ã‚µã‚¤ã‚º ç›¸æ‰‹ */
          }

          /* 11 å¹ãå‡ºã— */
          .line__container .line__left .text::after {
            content: '';
            position: absolute;
            display: block;
            width: 0;
            height: 0;
            left: -10px;
            top: 3px;
            border-right: 20px solid #EDF1EE;  /* å¹ãå‡ºã—æ ç·šè‰² ç›¸æ‰‹ */
            border-top: 10px solid transparent;
            border-bottom: 10px solid transparent; 
            transform: rotate(35deg); -webkit-transform: rotate(35deg);
          }

          /* 12 è‡ªåˆ†ã®ä¼šè©± */
          .line__container .line__right {
              position: relative;
              display: block;
              margin: 5px 0;
              max-width: 95%;
              float: right;
              margin-right: 5px;   /* 15px */
              clear: both;
          }

          /* 13 ã‚³ãƒ¡ãƒ³ãƒˆã‚¨ãƒªã‚¢ */
          .line__container .line__right .text {
            padding: 10px;
            border-radius: 20px;
            margin: 0;
            margin-left: 80px;
            background-color: #8de055;  /* å¹ãå‡ºã—èƒŒæ™¯è‰² è‡ªåˆ† */
            color: #000000;   /* ãƒˆãƒ¼ã‚¯æ–‡å­—è‰² è‡ªåˆ† */
            font-size: 11px;  /* ãƒˆãƒ¼ã‚¯æ–‡å­—ã‚µã‚¤ã‚º è‡ªåˆ† */
          }

          /* 14 å¹ãå‡ºã— */
          .line__container .line__right .text::after {
            content: '';
            position: absolute;
            display: block;
            width: 0;
            height: 0;
            right: -10px;
            top: 3px;
            border-left: 20px solid #8de055;  /* å¹ãå‡ºã—æ ç·šè‰² è‡ªåˆ† */
            border-top: 10px solid transparent;
            border-bottom: 10px solid transparent;
            transform: rotate(-35deg); -webkit-transform: rotate(-35deg);
          }

          /* 15 è‡ªåˆ†ãŒã‚¹ã‚¿ãƒ³ãƒ—ã‚’é€ã‚‹æ™‚ */
          .line__container .line__right .stamp {
            position: relative;
            margin-left: 80px;
          }

          /* 16 æ™‚é–“ã‚¨ãƒªã‚¢ ç›¸æ‰‹
          .line__container .line__left .time {
            content: '';
            position: absolute;
            display: inline-block;
            width: 0px;
            text-align: left;
            right: 0px;
            bottom: 0px;
            font-size: 80%;
            color: #ffffff;
          }
          */

          /* 17 æ—¢èª­ï¼æ™‚é–“ã‚¨ãƒªã‚¢ è‡ªåˆ† */
          .line__container .line__right .date {
            content: '';
            position: absolute;
            display: block;
            width: 100px;
            text-align: right;
            left: -25px;
            bottom: 0px;
            font-size: 80%;
            color: #ffffff;
          }

        </style>
    </body>
</html>
